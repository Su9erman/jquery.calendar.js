(function(b,c){var a={beginYear:1990,endYear:2020,readOnlyFlag:true,otherMonthShow:true,bg:"#efefef",bgHover:"#ffcc00",bgSelect:"#ffcc00",bgToday:"#00cc33",colorOtherMonth:"#ccc",colorThisMonth:"#000",slideDownTime:200,slideUpTime:200,patternDelimiter:"-",date2stringPattern:"yyyy-mm-dd",string2datePattern:"ymd",selector:".calendar"};var d=function(e){e=c.extend({},a,e||{});this.config=e;this.$panel=null;this.dateControl=null;this.weeks="日一二三四五六".split("");this.date=new Date();this.year=this.date.getFullYear();this.month=this.date.getMonth()+1};d.prototype={draw:function(){var h=this;var e=[];e.push("<iframe name='calendar-iframe' class='calendar-iframe' width='200' height='242' scrolling='no' frameborder='0' style='margin:0px;position:absolute;z-index:-2;opacity:0;'></iframe>");e.push('<table class="calendar-table" width="100%" border="0" cellpadding="3" cellspacing="1" align="center">');e.push('<thead><tr class="calendar-head">');e.push('<th><input name="go-prev-month" type="button" class="go-prev-month" value="&lt;" /></th>');e.push('<th colspan="5"><select name="year-select" class="year-select"></select><select name="month-select" class="month-select"><option value="1">1月</option><option value="2">2月</option><option value="3">3月</option><option value="4">4月</option><option value="5">5月</option><option value="6">6月</option><option value="7">7月</option><option value="8">8月</option><option value="9">9月</option><option value="10">10月</option><option value="11">11月</option><option value="12">12月</option></select></th>');e.push('<th><input name="go-next-month" type="button" class="go-next-month" value="&gt;" /></th>');e.push("</tr>");e.push("<tr>");for(var f=0;f<7;f++){e.push('<th class="week-header">');e.push(h.weeks[f]);e.push("</th>")}e.push("</tr></thead><tbody></tbody>");e.push('<tfoot><tr class="calendar-foot">');e.push("<th></th>");e.push('<th class="today-show" colspan="5"></th>');e.push("</tr></tfoot></table>");h.$panel=c("<div class='calendar-panel'></div>");c(document.body).append(h.$panel);h.$panel.html(e.join(""));h.$panel.find(".today-show").html("今天是"+h.year+"年"+h.month+"月"+h.date.getDate()+"日 星期"+this.weeks[h.date.getDay()]);if(!c("calendar-style")[0]){var g=".calendar-panel{width:200px;padding:2px;position:absolute;overflow:hidden;border:1px solid #cccccc;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;-webkit-box-shadow:4px 4px 1em rgba(0,0,0,0.3);-moz-box-shadow:4px 4px 1em rgba(0,0,0,0.3);box-shadow:4px 4px 1em rgba(0,0,0,0.3);}\n.calendar-panel table{font-size:12px;font-weight:600;text-align:center;background-color:#ffffff;}\n.calendar-panel td{background-color:#efefef;height:24px;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;}\nth.week-header{background-color:#666666;color:#ffffff;width:24px;height:24px;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;}\n.calendar-head th{padding:4px 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;}\n.calendar-head input{border:1px solid #ccc;background-color:#efefef;width:20px;height:20px;cursor:pointer;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;}\n.calendar-head select{font-size:12px;background-color:#efefef;}\n.year-select{width:66px;border:1px solid #ccc;margin-right:1px;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;}\n.month-select{width:60px;border:1px solid #ccc;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;}\n.calendar-foot th{padding:4px 0;}.today-show{font-size:12px;cursor:pointer;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;-moz-transition:background-color 0.3s ease-in;-webkit-transition:background-color 0.3s ease-in;transition:background-color 0.3s ease-in;}.today-show:hover{background-color:#efefef;}";c('<style type="text/css" id="calendar-style">'+g+"</style>").appendTo("head")}h._yearRange();h.$panel.find(".go-next-month").click(function(){h._goNextMonth()});h.$panel.find(".go-prev-month").click(function(){h._goPrevMonth()});h.$panel.find(".go-prev-month,.go-next-month").hover(function(){c(this).css("backgroundColor","#ffcc00")},function(){c(this).css("backgroundColor","#efefef")});h.$panel.find(".year-select,.month-select").change(function(){h._update()});h.$panel.find(".today-show").click(function(){h.date=new Date();h.year=h.date.getFullYear();h.month=h.date.getMonth()+1;h._changeSelect();h._bindData();h.dateControl.value=h._format(h.date,h.config.date2stringPattern);if(h.dateControl.onchange){h.dateControl.onchange()}h.$panel.slideUp(h.config.slideUpTime)});var j=c(h.config.selector);j.click(function(){h.show(this)});if(h.config.readOnlyFlag){j.attr("readonly","readonly")}c(document).on("click.mycalendar",function(){if(b.event.srcElement!=h.dateControl&&b.event.srcElement!=h.$panel[0]&&!jQuery.contains(h.$panel[0],b.event.srcElement)){h.$panel.slideUp(h.config.slideUpTime)}});h.$panel.hide()},show:function(e){var h=this;var f=h.getInputDate(e);h.dateControl=e;if(f){h.date=f;h.year=h.date.getFullYear();h.month=h.date.getMonth()+1}else{h.date=new Date();h.year=h.date.getFullYear();h.month=h.date.getMonth()+1}h._changeSelect();h._bindData();var g=h._getPosition(e);h.$panel.css({left:g.x+"px",top:(g.y+e.offsetHeight)+"px"});h.$panel.slideDown(h.config.slideDownTime)},_yearRange:function(){var g=this;var e=g.$panel.find(".year-select");for(var f=g.config.beginYear;f<=g.config.endYear;f++){e.append("<option value='"+f+"'>"+f+"年</option>")}},_goPrevMonth:function(){var e=this;if(e.year==e.config.beginYear&&e.month==1){return}e.month--;if(e.month==0){e.year--;e.month=12}e.date=new Date(e.year,e.month-1,1);e._changeSelect();e._bindData()},_goNextMonth:function(){var e=this;if(e.year==e.config.endYear&&e.month==12){return}e.month++;if(e.month==13){e.year++;e.month=1}e.date=new Date(e.year,e.month-1,1);e._changeSelect();e._bindData()},_changeSelect:function(){var e=this.$panel.find(".year-select")[0];var h=this.$panel.find(".month-select")[0];var g=this.date.getFullYear();var j=this.date.getMonth()+1;for(var f=0;f<e.options.length+1;f++){if(e.options[f].value==g){e[f].selected=true;break}}for(f=0;f<12;f++){if(h.options[f].value==j){h[f].selected=true;break}}},_bindData:function(){var l=this;var r=l._getWeeksObj(this.date);var o=[].slice.call(r.ret);var q=r.prev;var g=r.cur+q;var n=r.next+g;var j;var f=[];var m=[];var h;while(o.length){f.push(o.splice(0,7))}l._reDrawDate(f);var e=l.$panel.find(".calendar-table td");for(k=0;k<q;k++){h=e.eq(k);h.css({color:l.config.colorOtherMonth,backgroundColor:l.config.bg});if(this.config.otherMonthShow){h.css("cursor","pointer");h.on("click",l._bindClick()).on("mouseover",{backgroundColor:l.config.bgHover},l._bindMouseOverOut).on("mouseout",{backgroundColor:l.config.bg},l._bindMouseOverOut)}else{h.css("cursor","default")}}for(k=q;k<g;k++){h=e.eq(k);h.css({cursor:"pointer",color:l.config.colorThisMonth});h.on("click",l._bindClick());var p=new Date();if(p.getFullYear()==l.date.getFullYear()&&p.getMonth()==l.date.getMonth()&&p.getDate()==r.ret[k].getDate()){h.css("backgroundColor",l.config.bgToday);h.on("mouseover",{backgroundColor:l.config.bgHover},l._bindMouseOverOut).on("mouseout",{backgroundColor:l.config.bgToday},l._bindMouseOverOut)}else{if(l.date.getDate()==r.ret[k].getDate()){h.css("backgroundColor",l.config.bgSelect)}else{h.css("backgroundColor",l.config.bg);h.on("mouseover",{backgroundColor:l.config.bgHover},l._bindMouseOverOut).on("mouseout",{backgroundColor:l.config.bg},l._bindMouseOverOut)}}}for(var k=g;k<n;k++){h=e.eq(k);h.css("color",l.config.colorOtherMonth);if(this.config.otherMonthShow){h.css("cursor","pointer");h.on("click",l._bindClick()).on("mouseover",{backgroundColor:l.config.bgHover},l._bindMouseOverOut).on("mouseout",{backgroundColor:l.config.bg},l._bindMouseOverOut)}else{h.css("cursor","default")}}},_getPosition:function(g){var f=g.offsetLeft;var h=g.offsetTop;while(g=g.offsetParent){f+=g.offsetLeft;h+=g.offsetTop}return{x:f,y:h}},_getWeeksObj:function(r){var q=r.getFullYear();var p=r.getMonth()+1;var h=r.getDate();var e=[];var o=new Date(q,p-1,1).getDay();var g=new Date(q,p,0).getDate();var f=42-o-g;for(var m=1;m<=g;m++){e.push(new Date(q,p-1,m))}if(this.config.otherMonthShow){for(var n=0;n<o;n++){r=new Date(q,p-1,-1*n);e.unshift(r)}for(var l=1;l<=f;l++){e.push(new Date(q,p,l))}}else{for(n=0;n<o;n++){e.unshift("&nbsp;")}for(l=1;l<=f;l++){e.push("&nbsp;")}}return{ret:e,prev:o,cur:g,next:f}},_bindMouseOverOut:function(e){c(this).css("backgroundColor",e.data.backgroundColor)},_bindClick:function(){var e=this;return function(){var g=this;var f=e.getInputDate(g);e.setInputDate(e.dateControl,f);e.$panel.slideUp(e.config.slideUpTime)}},_update:function(){var f=this.$panel.find(".year-select")[0];var e=this.$panel.find(".month-select")[0];this.year=f.options[f.selectedIndex].value;this.month=e.options[e.selectedIndex].value;this.date=new Date(this.year,this.month-1,1);this._bindData()},_reDrawDate:function(h){var l=this;var m;var k;var e=c("<tbody/>");for(var g=0;g<6;g++){k=c("<tr/>").appendTo(e);for(var f=0;f<7;f++){m=c("<td>"+h[g][f].getDate()+"</td>");m.data("date",h[g][f]);m.appendTo(k)}}l.$panel.find(".calendar-table tbody").replaceWith(e)},setInputDate:function(f,g){var h=this;var e=f.value;if(f){f.value=h._format(g,h.config.date2stringPattern);c(f).data("date",g)}if(e!=f.value){if(f.onchange){f.onchange()}}},getInputDate:function(e){var f=this;return c(e).data("date")},_format:function(f,g){var h={"m+":f.getMonth()+1,"d+":f.getDate(),"h+":f.getHours(),"M+":f.getMinutes(),"s+":f.getSeconds(),"w+":"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".charAt(f.getDay()),"q+":Math.floor((f.getMonth()+3)/3),S:f.getMilliseconds()};if(/(y+)/.test(g)){g=g.replace(RegExp.$1,(f.getFullYear()+"").substr(4-RegExp.$1.length))}for(var e in h){if(new RegExp("("+e+")").test(g)){g=g.replace(RegExp.$1,RegExp.$1.length==1?h[e]:("00"+h[e]).substr((""+h[e]).length))}}return g},_toDate:function(j,g,h){g=g||"-";h=h||"ymd";var f=j.split(g);var k=parseInt(f[h.indexOf("y")],10);if(k.toString().length<=2){k+=2000}if(isNaN(k)){k=new Date().getFullYear()}var e=parseInt(f[h.indexOf("m")],10)-1;var i=parseInt(f[h.indexOf("d")],10);if(isNaN(i)){i=1}return new Date(k,e,i)}};b.Calendar=d})(window,jQuery);